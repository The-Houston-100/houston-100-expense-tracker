<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Houston 100 Expense Tracker</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background-color: #f5f7fa;
            line-height: 1.6;
            color: #333;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px 0;
            margin-bottom: 30px;
            border-radius: 12px;
            text-align: center;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }

        .header h1 {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .dashboard {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: white;
            padding: 25px;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
            text-align: center;
            transition: transform 0.2s ease;
        }

        .stat-card:hover {
            transform: translateY(-2px);
        }

        .stat-card h3 {
            font-size: 2rem;
            font-weight: 700;
            color: #667eea;
            margin-bottom: 5px;
        }

        .stat-card p {
            color: #666;
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 2fr;
            gap: 30px;
            margin-bottom: 30px;
        }

        .expense-form {
            background: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
            height: fit-content;
        }

        .expense-list {
            background: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: #333;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #e1e8ed;
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.2s ease;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            transition: all 0.2s ease;
            width: 100%;
        }

        .btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.3);
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn-secondary {
            background: #6c757d;
            margin-left: 10px;
            width: auto;
            min-width: 100px;
        }

        .expense-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        .expense-table th,
        .expense-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #e1e8ed;
        }

        .expense-table th {
            background-color: #f8f9fa;
            font-weight: 600;
            color: #333;
            position: sticky;
            top: 0;
        }

        .expense-table tbody tr:hover {
            background-color: #f8f9fa;
        }

        .amount {
            font-weight: 700;
            color: #e74c3c;
        }

        .category-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .category-office { background-color: #e3f2fd; color: #1976d2; }
        .category-tech { background-color: #f3e5f5; color: #7b1fa2; }
        .category-marketing { background-color: #e8f5e8; color: #388e3c; }
        .category-travel { background-color: #fff3e0; color: #f57c00; }
        .category-meals { background-color: #fce4ec; color: #c2185b; }
        .category-default { background-color: #f5f5f5; color: #616161; }

        .loading {
            text-align: center;
            padding: 40px;
            color: #666;
        }

        .error {
            background-color: #ffebee;
            color: #c62828;
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
            border-left: 4px solid #c62828;
        }

        .success {
            background-color: #e8f5e8;
            color: #2e7d32;
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
            border-left: 4px solid #2e7d32;
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #666;
        }

        .empty-state h3 {
            margin-bottom: 10px;
            color: #333;
        }

        @media (max-width: 768px) {
            .main-content {
                grid-template-columns: 1fr;
            }
            
            .header h1 {
                font-size: 1.8rem;
            }
            
            .container {
                padding: 10px;
            }
            
            .expense-table {
                font-size: 0.9rem;
            }
            
            .expense-table th,
            .expense-table td {
                padding: 8px 4px;
            }
        }

        .filters {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .filter-group {
            flex: 1;
            min-width: 150px;
        }

        .action-buttons {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin-top: 10px;
        }

        .btn-small {
            padding: 6px 12px;
            font-size: 0.85rem;
            width: auto;
            min-width: 80px;
        }

        .btn-danger {
            background: #dc3545;
        }

        .btn-edit {
            background: #ffc107;
            color: #333;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1>Houston 100 Expense Tracker</h1>
            <p>Kingdom-focused financial stewardship and accountability</p>
        </div>

        <!-- Dashboard Stats -->
        <div class="dashboard">
            <div class="stat-card">
                <h3 id="totalThisMonth">$0.00</h3>
                <p>This Month</p>
            </div>
            <div class="stat-card">
                <h3 id="totalAllTime">$0.00</h3>
                <p>All Time</p>
            </div>
            <div class="stat-card">
                <h3 id="expenseCount">0</h3>
                <p>Total Expenses</p>
            </div>
            <div class="stat-card">
                <h3 id="avgExpense">$0.00</h3>
                <p>Average Expense</p>
            </div>
        </div>

        <!-- Main Content -->
        <div class="main-content">
            <!-- Expense Form -->
            <div class="expense-form">
                <h2>Add New Expense</h2>
                <form id="expenseForm">
                    <div class="form-group">
                        <label for="date">Date *</label>
                        <input type="date" id="date" name="date" required>
                    </div>

                    <div class="form-group">
                        <label for="amount">Amount *</label>
                        <input type="number" id="amount" name="amount" step="0.01" min="0" required placeholder="0.00">
                    </div>

                    <div class="form-group">
                        <label for="category">Category *</label>
                        <select id="category" name="category" required>
                            <option value="">Select Category</option>
                            <option value="Office Supplies">Office Supplies</option>
                            <option value="Technology">Technology</option>
                            <option value="Marketing">Marketing</option>
                            <option value="Travel">Travel</option>
                            <option value="Meals & Entertainment">Meals & Entertainment</option>
                            <option value="Professional Services">Professional Services</option>
                            <option value="Training & Education">Training & Education</option>
                            <option value="Utilities">Utilities</option>
                            <option value="Rent">Rent</option>
                            <option value="Insurance">Insurance</option>
                            <option value="Other">Other</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="description">Description *</label>
                        <input type="text" id="description" name="description" required placeholder="Brief description of expense">
                    </div>

                    <div class="form-group">
                        <label for="paymentMethod">Payment Method</label>
                        <select id="paymentMethod" name="paymentMethod">
                            <option value="">Select Payment Method</option>
                            <option value="Cash">Cash</option>
                            <option value="Credit Card">Credit Card</option>
                            <option value="Debit Card">Debit Card</option>
                            <option value="Check">Check</option>
                            <option value="Bank Transfer">Bank Transfer</option>
                            <option value="PayPal">PayPal</option>
                            <option value="Venmo">Venmo</option>
                            <option value="Other">Other</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="memberName">Member Name</label>
                        <input type="text" id="memberName" name="memberName" placeholder="Houston 100 member name">
                    </div>

                    <div class="form-group">
                        <label for="project">Project</label>
                        <input type="text" id="project" name="project" placeholder="Related Houston 100 project">
                    </div>

                    <div class="form-group">
                        <label for="notes">Notes</label>
                        <textarea id="notes" name="notes" rows="3" placeholder="Additional notes or details"></textarea>
                    </div>

                    <button type="submit" class="btn" id="submitBtn">Add Expense</button>
                </form>
            </div>

            <!-- Expense List -->
            <div class="expense-list">
                <h2>Recent Expenses</h2>
                
                <!-- Filters -->
                <div class="filters">
                    <div class="filter-group">
                        <label for="filterCategory">Filter by Category</label>
                        <select id="filterCategory">
                            <option value="">All Categories</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label for="filterMonth">Filter by Month</label>
                        <select id="filterMonth">
                            <option value="">All Months</option>
                        </select>
                    </div>
                </div>

                <!-- Messages -->
                <div id="messages"></div>

                <!-- Expense Table -->
                <div id="expenseTableContainer">
                    <div class="loading">Loading expenses...</div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Configuration - REPLACE THE URL BELOW WITH YOUR ACTUAL API ENDPOINT
        const API_URL = 'https://script.google.com/macros/s/AKfycbyW8fRHU0Ie5CPzuIk1niP250vbEgY07xJl3dfIskGpmJiqC7qf2jNJranshGaTFyAC_Q/exec';

        // Global variables
        let expenses = [];
        let filteredExpenses = [];

        // Initialize app
        document.addEventListener('DOMContentLoaded', function() {
            initializeApp();
        });

        async function initializeApp() {
            // Set today's date as default
            document.getElementById('date').valueAsDate = new Date();
            
            // Load expenses
            await loadExpenses();
            
            // Set up event listeners
            setupEventListeners();
            
            // Update dashboard
            updateDashboard();
            
            // Populate filters
            populateFilters();
        }

        function setupEventListeners() {
            // Form submission
            document.getElementById('expenseForm').addEventListener('submit', handleFormSubmit);
            
            // Filter changes
            document.getElementById('filterCategory').addEventListener('change', applyFilters);
            document.getElementById('filterMonth').addEventListener('change', applyFilters);
        }

        async function loadExpenses() {
            try {
                showMessage('Loading expenses...', 'info');
                
                const response = await fetch(API_URL);
                const data = await response.json();
                
                if (data.success) {
                    expenses = data.data || [];
                    filteredExpenses = [...expenses];
                    renderExpenseTable();
                    clearMessages();
                } else {
                    throw new Error(data.error || 'Failed to load expenses');
                }
            } catch (error) {
                showMessage('Error loading expenses: ' + error.message, 'error');
                console.error('Error loading expenses:', error);
            }
        }

        async function handleFormSubmit(e) {
            e.preventDefault();
            
            const submitBtn = document.getElementById('submitBtn');
            const originalText = submitBtn.textContent;
            
            try {
                // Disable button and show loading
                submitBtn.disabled = true;
                submitBtn.textContent = 'Adding...';
                
                // Get form data
                const formData = new FormData(e.target);
                const expenseData = {
                    date: formData.get('date'),
                    amount: parseFloat(formData.get('amount')),
                    category: formData.get('category'),
                    description: formData.get('description'),
                    paymentMethod: formData.get('paymentMethod'),
                    memberName: formData.get('memberName'),
                    project: formData.get('project'),
                    notes: formData.get('notes')
                };

                // Validate required fields
                if (!expenseData.date || !expenseData.amount || !expenseData.category || !expenseData.description) {
                    throw new Error('Please fill in all required fields');
                }

                // Send to API
                const response = await fetch(API_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        action: 'create',
                        data: expenseData
                    })
                });

                const result = await response.json();

                if (result.success) {
                    showMessage('Expense added successfully!', 'success');
                    
                    // Reset form
                    e.target.reset();
                    document.getElementById('date').valueAsDate = new Date();
                    
                    // Reload expenses
                    await loadExpenses();
                    updateDashboard();
                    populateFilters();
                } else {
                    throw new Error(result.error || 'Failed to add expense');
                }
            } catch (error) {
                showMessage('Error adding expense: ' + error.message, 'error');
                console.error('Error adding expense:', error);
            } finally {
                // Re-enable button
                submitBtn.disabled = false;
                submitBtn.textContent = originalText;
            }
        }

        function renderExpenseTable() {
            const container = document.getElementById('expenseTableContainer');
            
            if (filteredExpenses.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <h3>No expenses found</h3>
                        <p>Start by adding your first expense using the form on the left.</p>
                    </div>
                `;
                return;
            }

            let tableHTML = `
                <table class="expense-table">
                    <thead>
                        <tr>
                            <th>Date</th>
                            <th>Category</th>
                            <th>Description</th>
                            <th>Amount</th>
                            <th>Payment</th>
                            <th>Member</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
            `;

            filteredExpenses.forEach(expense => {
                const date = new Date(expense.Date).toLocaleDateString();
                const amount = parseFloat(expense.Amount || 0).toFixed(2);
                const categoryClass = getCategoryClass(expense.Category);

                tableHTML += `
                    <tr>
                        <td>${date}</td>
                        <td><span class="category-badge ${categoryClass}">${expense.Category || 'N/A'}</span></td>
                        <td>${expense.Description || 'N/A'}</td>
                        <td class="amount">$${amount}</td>
                        <td>${expense['Payment Method'] || 'N/A'}</td>
                        <td>${expense['Member Name'] || 'N/A'}</td>
                        <td>
                            <div class="action-buttons">
                                <button class="btn btn-edit btn-small" onclick="editExpense(${expense.id})">Edit</button>
                                <button class="btn btn-danger btn-small" onclick="deleteExpense(${expense.id})">Delete</button>
                            </div>
                        </td>
                    </tr>
                `;
            });

            tableHTML += `
                    </tbody>
                </table>
            `;

            container.innerHTML = tableHTML;
        }

        function getCategoryClass(category) {
            if (!category) return 'category-default';
            
            const categoryMap = {
                'Office Supplies': 'category-office',
                'Technology': 'category-tech',
                'Marketing': 'category-marketing',
                'Travel': 'category-travel',
                'Meals & Entertainment': 'category-meals'
            };
            
            return categoryMap[category] || 'category-default';
        }

        function updateDashboard() {
            if (expenses.length === 0) {
                document.getElementById('totalThisMonth').textContent = '$0.00';
                document.getElementById('totalAllTime').textContent = '$0.00';
                document.getElementById('expenseCount').textContent = '0';
                document.getElementById('avgExpense').textContent = '$0.00';
                return;
            }

            // Calculate totals
            const currentMonth = new Date().getMonth();
            const currentYear = new Date().getFullYear();
            
            const thisMonthExpenses = expenses.filter(expense => {
                const expenseDate = new Date(expense.Date);
                return expenseDate.getMonth() === currentMonth && expenseDate.getFullYear() === currentYear;
            });

            const totalThisMonth = thisMonthExpenses.reduce((sum, expense) => sum + parseFloat(expense.Amount || 0), 0);
            const totalAllTime = expenses.reduce((sum, expense) => sum + parseFloat(expense.Amount || 0), 0);
            const avgExpense = expenses.length > 0 ? totalAllTime / expenses.length : 0;

            // Update DOM
            document.getElementById('totalThisMonth').textContent = '$' + totalThisMonth.toFixed(2);
            document.getElementById('totalAllTime').textContent = '$' + totalAllTime.toFixed(2);
            document.getElementById('expenseCount').textContent = expenses.length.toString();
            document.getElementById('avgExpense').textContent = '$' + avgExpense.toFixed(2);
        }

        function populateFilters() {
            // Populate category filter
            const categories = [...new Set(expenses.map(expense => expense.Category).filter(Boolean))].sort();
            const categoryFilter = document.getElementById('filterCategory');
            categoryFilter.innerHTML = '<option value="">All Categories</option>';
            categories.forEach(category => {
                categoryFilter.innerHTML += `<option value="${category}">${category}</option>`;
            });

            // Populate month filter
            const months = [...new Set(expenses.map(expense => {
                if (expense.Date) {
                    const date = new Date(expense.Date);
                    return `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}`;
                }
                return null;
            }).filter(Boolean))].sort().reverse();

            const monthFilter = document.getElementById('filterMonth');
            monthFilter.innerHTML = '<option value="">All Months</option>';
            months.forEach(month => {
                const [year, monthNum] = month.split('-');
                const monthName = new Date(year, monthNum - 1).toLocaleDateString('en-US', { year: 'numeric', month: 'long' });
                monthFilter.innerHTML += `<option value="${month}">${monthName}</option>`;
            });
        }

        function applyFilters() {
            const categoryFilter = document.getElementById('filterCategory').value;
            const monthFilter = document.getElementById('filterMonth').value;

            filteredExpenses = expenses.filter(expense => {
                // Category filter
                if (categoryFilter && expense.Category !== categoryFilter) {
                    return false;
                }

                // Month filter
                if (monthFilter && expense.Date) {
                    const expenseDate = new Date(expense.Date);
                    const expenseMonth = `${expenseDate.getFullYear()}-${String(expenseDate.getMonth() + 1).padStart(2, '0')}`;
                    if (expenseMonth !== monthFilter) {
                        return false;
                    }
                }

                return true;
            });

            renderExpenseTable();
        }

        function showMessage(message, type) {
            const messagesDiv = document.getElementById('messages');
            messagesDiv.innerHTML = `<div class="${type}">${message}</div>`;
            
            // Auto-clear success messages
            if (type === 'success') {
                setTimeout(() => {
                    messagesDiv.innerHTML = '';
                }, 3000);
            }
        }

        function clearMessages() {
            document.getElementById('messages').innerHTML = '';
        }

        // Placeholder functions for edit/delete (we'll implement these next)
        function editExpense(id) {
            alert('Edit functionality coming soon!');
        }

        async function deleteExpense(id) {
            if (confirm('Are you sure you want to delete this expense?')) {
                try {
                    const response = await fetch(API_URL, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            action: 'delete',
                            id: id
                        })
                    });

                    const result = await response.json();

                    if (result.success) {
                        showMessage('Expense deleted successfully!', 'success');
                        await loadExpenses();
                        updateDashboard();
                        populateFilters();
                    } else {
                        throw new Error(result.error || 'Failed to delete expense');
                    }
                } catch (error) {
                    showMessage('Error deleting expense: ' + error.message, 'error');
                    console.error('Error deleting expense:', error);
                }
            }
        }
    </script>
</body>
</html>
